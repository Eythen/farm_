<html lang="zh-cmn-Hans">

	<head>
		<!-- 声明文档使用的字符编码 -->
		<meta charset='utf-8'>
		<!-- 优先使用 IE 最新版本和 Chrome -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<!-- 页面描述 -->
		<meta name="description" content="不超过150个字符" />
		<!-- 页面关键词 -->
		<meta name="keywords" content="" />
		<!-- 网页作者 -->
		<meta name="author" content="guo,652730268@qq.com" />
		<!-- 搜索引擎抓取 -->
		<meta name="robots" content="index,follow" />
		<!-- 为移动设备添加 viewport -->
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=3,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" />
		<!-- `width=device-width` 会导致 iPhone 5 添加到主屏后以 WebApp 全屏模式打开页面时出现黑边 http://bigc.at/ios-webapp-viewport-meta.orz -->

		<!-- iOS 设备 begin -->
		<meta name="apple-mobile-web-app-title" content="标题">
		<!-- 添加到主屏后的标题（iOS 6 新增） -->
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->

		<!--meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL" -->
		<!-- 添加智能 App 广告条 Smart App Banner（iOS 6+ Safari） -->
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<!-- 设置苹果工具栏颜色 -->
		<meta name="format-detection" content="telphone=no, email=no" />
		<!-- 忽略页面中的数字识别为电话，忽略email识别 -->

		<!-- 启用360浏览器的极速模式(webkit) -->
		<meta name="renderer" content="webkit">
		<!-- 避免IE使用兼容模式 -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- 不让百度转码 -->
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->
		<meta name="HandheldFriendly" content="true">
		<!-- 微软的老式浏览器 -->
		<meta name="MobileOptimized" content="320">
		<!-- uc强制竖屏 -->
		<meta name="screen-orientation" content="portrait">
		<!-- QQ强制竖屏 -->
		<meta name="x5-orientation" content="portrait">
		<!-- UC强制全屏 -->
		<meta name="full-screen" content="yes">
		<!-- QQ强制全屏 -->
		<meta name="x5-fullscreen" content="true">
		<!-- UC应用模式 -->
		<meta name="browsermode" content="application">
		<!-- QQ应用模式 -->
		<meta name="x5-page-mode" content="app">
		<!-- windows phone 点击无高光 -->
		<meta name="msapplication-tap-highlight" content="no">
		<!-- iOS 图标 begin -->
		<link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-57x57-precomposed.png" />
		<!-- iPhone 和 iTouch，默认 57x57 像素，必须有 -->
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png" />
		<!-- Retina iPhone 和 Retina iTouch，114x114 像素，可以没有，但推荐有 -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png" />
		<!-- Retina iPad，144x144 像素，可以没有，但推荐有 -->
		<!-- iOS 图标 end -->

		<!-- iOS 启动画面 begin -->
		<link rel="apple-touch-startup-image" sizes="768x1004" href="__PUBLIC__/skin/agent/img/App-ios-logo-152x152.png" />

		<link rel="apple-touch-startup-image" href="__PUBLIC__/skin/agent/img/App-ios-logo-152x152.png" />
		<!-- iPhone/iPod Touch 竖屏 320x480 (标准分辨率) -->
		<link rel="apple-touch-startup-image" sizes="640x960" href="__PUBLIC__/skin/agent/img/App-ios-logo-152x152.png" />
		<!-- iPhone/iPod Touch 竖屏 640x960 (Retina) -->
		<link rel="apple-touch-startup-image" sizes="640x1136" href="__PUBLIC__/skin/agent/img/App-ios-logo-152x152.png" />
		<!-- iPhone 5/iPod Touch 5 竖屏 640x1136 (Retina) -->
		<!-- iOS 启动画面 end -->

		<!-- iOS 设备 end -->
		<meta name="msapplication-TileColor" content="#000" />
		<!-- Windows 8 磁贴颜色 -->
		<meta name="msapplication-TileImage" content="icon.png" />
		<!-- Windows 8 磁贴图标 -->

		<link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml" />
		<!-- 添加 RSS 订阅 -->
		<link rel="shortcut icon" type="image/ico" href="/favicon.ico" />
		<!-- 添加 favicon icon -->

		<title>注册</title>

		<link href="__PUBLIC__/skin/agent/css/weui.min.css" rel="stylesheet">
		<link href="__PUBLIC__/skin/agent/css/jquery-weui.css" rel="stylesheet">
		<link href="__PUBLIC__/skin/agent/font/iconfont.css" rel="stylesheet">
		<link href="__PUBLIC__/skin/agent/css/style.css" rel="stylesheet">

		<!-- 自适应处理页面js -->
		<script src="__PUBLIC__/skin/agent/js/flexible.js"></script>

	</head>

	<body ontouchstart>
        
        <div class="stage">
			<div class="Agents-reg">
				<div class="logo">
					<img src="__PUBLIC__/skin/agent/img/logo.png">
				</div>
				<div class="login-bj">
					<div class="panel">
						<div class="form-horizontal">
							<div class="form-group">
								<i class="icon-phone"></i>
								<input type="number" pattern="[0-9]*" class="form-control" id="Mobile" placeholder="手机号" required="" value="{$user_mobile}">
							</div>
							<div class="form-group">
								<i class="icon-yanzheng"></i>
								<input type="number" pattern="[0-9]*" class="form-control" id="verify" placeholder="验证码" required>
								<input type="button" id="btn" class="weui-vcode-btn" value="获取验证码" />
							</div>
							<div class="form-group">
								<i class="icon-mima"></i>
								<input type="password" class="form-control" id="pwd" placeholder="密　码">
								<div class="icon-wrapper">
									<span toggle="#pwd" class="icon-xianshimima field-icon toggle-password"></span>
								</div>
							</div>
							<div class="form-group">
								<i class="icon-icon-"></i>
								<input type="number" pattern="[0-9]*" class="form-control" id="phone" placeholder="业务员手机号(必填)" required="" value="{$manager_mobile}">
							</div>
							<a class="login-btn login-btn-green" id="reg" href="javascript:void(0);">注  册</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="media">该页面不支持电脑端浏览，请用手机浏览。</div>

	</body>

	<!-- js -->
	<script src="__PUBLIC__/skin/agent/js/jquery-2.1.4.js"></script>
	<script src="__PUBLIC__/skin/agent/js/fastclick.js"></script>
	<script>
		$(function() {
			//消除延迟
			FastClick.attach(document.body);
		});
	</script>
	<script src="__PUBLIC__/skin/agent/js/jquery-weui.js"></script>
	<script>
		//输入框判断
		$(function() {
			$('#reg').click(function(event) {
				var Mobile = $('#Mobile').val(),
				    phone = $('#phone').val(),
					partten = /^1\d{10}$/;
					rege = /^1\d{10}$/;
					verify = $('#verify').val();
					pwd = $('#pwd').val();
				    regExp = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,18}$/;
				    
				if(Mobile == '') {
					$('#Mobile').focus();
					$.toast("输入11位数手机号", "text");
					return false;
				} else if(!partten.test(Mobile)) {
					$.toast("输入手机号码不正确", "text");
					return false;
				} else if(verify == '') {
					$('#verify').focus();
					$.toast("输入4位数验证码", "text");
					return false;
				} else if(pwd.length < 6) {
					$('#pwd').focus();
					$.toast("输入6-18位字母或数字密码?", "text");
					return false;
				} else if(pwd.length > 18) {
					$('#pwd').focus();
					$.toast("输入6-18位字母或数字密码?", "text");
					return false;
				/*} else if(!regExp.test(pwd)) {
					$('#pwd').focus();
					$.toast("输入6-18位字母或数字密码?", "text");
					return false;*/
				} else if(phone == '') {
					$('#phone').focus();
					$.toast("输入业务员手机号", "text");
					return false;
				} else if(!rege.test(phone)) {
					$.toast("业务员手机号码不正确", "text");
					return false;
				} else {
					$.showLoading('正在处理,请稍后');
					//return;
					//$.showLoading();
					$.ajax({
	                    url: "{:url('add')}",
	                    type: 'POST',
	                    dataType: 'json',
	                    data: {mobile: Mobile, code:verify, password:pwd, manager_mobile:phone},
	                    success: function(data){
							$.hideLoading();
	                        if(data.code){
								window.location.href="{:url('Users/index')}";
	                        }else{
								$.toast(data.msg, 'text');
								return false;
	                            
	                        }
	                    }
	                });
				}
			});
			var wait = 60;
			document.getElementById("btn").disabled = false;
			function time(o) {
				if(wait == 0) {
					o.removeAttribute("disabled");
					o.value = "获取验证码";
					wait = 60;
				} else {
					o.setAttribute("disabled", true);
					o.value = "重新发送(" + wait + ")";
					wait--;
					setTimeout(function() {
						time(o)
					},1000)
				}
			}
			document.getElementById("btn").onclick = function() {
				time(this);
				var Mobile = $('#Mobile').val();
					var partten = /^1\d{10}$/;
						if(Mobile == '') {
							$('#Mobile').focus();
							$.toptip('手机不能为空！', 'warning');
							return false;
						}
						if(!partten.test(Mobile)) {
							$.toptip('请输入正确的手机号码？', 'warning');
							return false;
						}
					$.showLoading();
					$.ajax({
	                    url: "{:url('sendcode')}",
	                    type: 'POST',
	                    dataType: 'json',
	                    data: {mobile: Mobile},
	                    success: function(data){
							$.hideLoading();
	                        if(data.code){

								$.toast('已发送', 'success');
	                        }else{
	                            $.toast(data.msg, 'text'); 
	                        }
	                    }
	                });
			}

			//隐藏或显示密码 
			$(".icon-wrapper").click(function() {
				$(".toggle-password").toggleClass(".icon-xianshimima icon-xianshimima1");
				var input = $($(".toggle-password").attr("toggle"));
				if(input.attr("type") == "password") {
					input.attr("type", "text");
				} else {
					input.attr("type", "password");
				}
			});
		});
	</script>

</html>